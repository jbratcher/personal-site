{
  "date": "2020-04-03T18:00:36.704Z",
  "title": "Nuxt Github Pages Example",
  "description": "Avoiding common pitfalls like 404 errors",
  "body": "Github Pages is an easy, integrated way to host a Github project with Nuxt. However, there are some common configuration pitfalls you want to avoid due to how Github Pages and Nuxt work.\r\n\r\nThe Nuxt documentation has a [pretty decent guide](https://nuxtjs.org/faq/github-pages/) on how to your Nuxt app up and running on Github Pages but it does seem to neglect a few issues that I ran into with a recent project update. These issues crop up if you are using SSR ('universal' mode).\r\n\r\n> If you refresh any page but the home page, you get a 404.\r\n\r\nThis drove me crazy for awhile as I couldn't find a straight answer. Most answers I found in Nuxt Github issues stated this was due to the base route not being configured correctly for Github Pages but I had made sure that was not the case.\r\n\r\nBefore we get into that let's go through the normal process and get the app up and running on Github Pages.\r\n\r\n## Getting Started\r\n\r\nTo create a Nuxt app:\r\n\r\nFrom the command line:\r\n`npx create-nuxt-app [app-name]`\r\n\r\nSelect the options you want and the app with be created for you.\r\n\r\n`cd [app-name]` and `npm run dev`\r\n\r\nThis will get the app up and running in development mode. Now we will do some setup so that we can host the app on Github Pages.\r\n\r\n## Github Pages Configuration\r\n\r\n###### Note: if you haven't already, create a new github repo for the project and push the master branch.\r\n\r\n###### After creating a new repo on Github, run these from the command line,\r\n\r\n```\r\n  git init\r\n  git add .\r\n  git commit -m \"initial commit\"\r\n  git remote add origin [github-repo-url]\r\n  git push -u origin master\r\n```\r\n\r\nAgain, Nuxt has documentation on how to do the basic setup for Github Pages but it is lacking in some respects. Several of the following steps are outlined in the Nuxt documentation.\r\n\r\nIn `nuxt.config.js`:\r\n\r\n```javascript\r\n// only add `router.base = '/<repository-name>/'` if `DEPLOY_ENV` is `GH_PAGES`\r\nconst routerBase =\r\n  process.env.DEPLOY_ENV === 'GH_PAGES'\r\n    ? {\r\n        router: {\r\n          base: '/<repository-name>/'\r\n        }\r\n      }\r\n    : {}\r\n\r\nexport default {\r\n  ...routerBase\r\n}\r\n```\r\n\r\nIn `package.json`:\r\n\r\n```javascript\r\n\"scripts\": {\r\n  \"build:gh-pages\": \"DEPLOY_ENV=GH_PAGES nuxt build\",\r\n  \"generate:gh-pages\": \"DEPLOY_ENV=GH_PAGES nuxt generate\"\r\n},\r\n```\r\n\r\n- Note: Windows users may need to install an npm package called cross-env\r\n  `npm install cross-env --save-dev`\r\n  Then prepend `cross-env` to the build and generate scripts:\r\n\r\n```javascript\r\n  \"build:gh-pages\": \"cross-env DEPLOY_ENV=GH_PAGES nuxt build\",\r\n  \"generate:gh-pages\": \"cross-env DEPLOY_ENV=GH_PAGES nuxt generate\"\r\n```\r\n\r\nCreate a local gh-pages branch by running `git checkout -b gh-pages` from the command line.\r\n\r\nTo create a static version of your app, you will need to run the `build` and `generate` commands sequentially.\r\n\r\n```\r\n  npm run build:gh-pages\r\n  npm run generate:gh-pages\r\n```\r\n\r\nThen add and commit the new files.\r\n\r\n```\r\n  git add .\r\n  git commit -m \"deploy\"\r\n```\r\n\r\nSince the `build` and `generate` commands create a static site in the dist folder, you will need to remove the dist folder from the .gitignore file and push only the dist folder to the gh-pages branch.\r\n\r\nTo push a sub folder to Github, from the command line:\r\n\r\n```\r\ngit subtree push --prefix dist origin gh-pages\r\n```\r\n\r\nThe git subtree command allows you to push a subfolder only. You can register this as a script in package.json for easy deployment.\r\n\r\nIn `package.json`\r\n\r\n```javascript\r\n  \"deploy\": \"git subtree push --prefix dist origin gh-pages\",\r\n```\r\n\r\nYou can further abstract the deployment process by sequentially chaining the npm scripts into one command:\r\n\r\nIn `package.json`:\r\n\r\n```javascript\r\n\"scripts\": {\r\n  \"build:gh-pages\": \"cross-env DEPLOY_ENV=GH_PAGES nuxt build\",\r\n    \"generate:gh-pages\": \"cross-env DEPLOY_ENV=GH_PAGES nuxt generate\",\r\n    \"deploy\": \"git subtree push --prefix dist origin gh-pages\",\r\n    \"deploy:gh-pages\": \"npm run build:gh-pages && npm run generate:gh-pages && git add . && git commit -m \\\"deploy\\\" && npm run deploy\"\r\n}\r\n```\r\n\r\n- Note: make sure to enable Github Pages on your repo from the Settings page and ensure the source is the gh-pages branch. If you have already pushed the gh-pages branch to your repo, it should be automagically setup for you.\r\n\r\n## 404 error when refreshing subpages\r\n\r\nThe biggest blunder that happens when you use this setup is that any pages besides the homepage will 404 if you refresh the page. This will quickly ruin your user experience.\r\n\r\nFor example, I created a basic About page by creating an `About.vue` file in the `pages` directory. This page is a basic vue component with only a template filled out.\r\n\r\n`About.vue`\r\n\r\n```javascript\r\n<template>\r\n  <h1>This is the about page</h1>\r\n</template>\r\n\r\n<script>\r\nexport default {}\r\n</script>\r\n\r\n<style></style>\r\n```\r\n\r\nFor simplicity sake, I also made a basic navigation in the `layouts/default.vue` file:\r\n\r\n```javascript\r\n<template>\r\n  <div>\r\n    <nav>\r\n      <ul>\r\n        <nuxt-link to=\"/\">Home</nuxt-link>\r\n        <nuxt-link to=\"/about\">About</nuxt-link>\r\n      </ul>\r\n    </nav>\r\n    <nuxt />\r\n  </div>\r\n</template>\r\n\r\n<style>\r\n...\r\n</style>\r\n```\r\n\r\nCurrently, on the hosted Github Pages version of the app, if you navigate to the About page it renders fine but, upon refresh, it 404's.\r\n\r\nI'm not sure if this happens on other static hosting platforms but it definitely plagues Github Pages at least with Nuxt apps.\r\n\r\nThankfully, there is a super easy fix.\r\n\r\nIn `nuxt.config.js`:\r\n\r\n```javascript\r\nexport default {\r\n  generate: {\r\n    fallback: true\r\n  }\r\n}\r\n```\r\n\r\nThe [generate propery](https://nuxtjs.org/api/configuration-generate) in Nuxt config,\r\nconfigures _the generation of your universal web application to a static web application_. This configuration property helps set up how the static folder (dist by default) is generated.\r\n\r\nNow, you can run your `build`, `generate` and `deploy` scripts and to push up this change and the pages will refresh as intended without a 404 error.\r\n\r\nIn all truth, I'm not exactly sure how this works. The property is specifically states it is for use in [customizing fallback pages](https://nuxtjs.org/api/configuration-generate#fallback) not for preventing pages from 404'ing.\r\n\r\nI stumbled upon this solution in a [Nuxt Github issue](https://github.com/nuxt/nuxt.js/issues/6088) and it seems to work without fail. Curiously, the issue is about a SPA app with dynamic routes and this app is Universal and was failing on static routes. However, a fixed issues is a fixed issue.\r\n\r\nMaybe, I'll open my own issue to see if I can gain some clarity from the Nuxt team.\r\n\r\nSo, that is it. Your Nuxt app should now be fully hosted without issue on Github Pages. Happy coding!\n\n***UPDATE***\n\nI did open an [issue](https://github.com/nuxt/nuxt.js/issues/7172) with Nuxt.js and got a quick response.\n\n>This is intended. When generating pages, you have to tell your platform/web server (GitHub pages in your case) in case you want to handle 404 errors \"through your own application\". This is usually not wanted when building non-SPAs but highly recommended for SPAs (to avoid the mentioend reload - 404 - issue).\r\n\r\n>When enabled, generate.fallback creates a 404.html which is essentially an SPA fallback page. GitHub pages picks it up automatically and redirects all \"not found URLs\" there.\r\n\r\n>However, generated URLs (with mode: universal) should not need a redirect. In your case, the capitalization of About.vue is giving troubles here. Lowercasing it and it should work fine 👍🏻\r\n\r\n>For the future, it might be an idea to unify pages, no matter how they are capitalized (e.g. About.vue should behave the same like about.vue or aBoUt.vue, as long as no drawbacks are present (cc @pi0).\r\n\r\nIt appears I fubar'd the file name by capitalizing it as it should actually be lowercased.  A simple oversight and quick fix to be had!\n\nOtherwise it appears as this behavior is intended as far as the 404 goes when using generate with web platforms such as Github Pages.\n",
  "thumbnail": "/img/nuxt-github-pages.svg",
  "hero": "/img/nuxt-github-pages.svg"
}